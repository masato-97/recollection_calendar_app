<h2>Edit <%= resource_name.to_s.humanize %></h2>

<%= form_for(resource, as: resource_name, url: registration_path(resource_name), html: { method: :put }) do |f| %>
  <%= render "devise/shared/error_messages", resource: resource %>

  <div class="field">
    <%= f.label :name %><br />
    <%= f.text_field :name, autofocus: true %>
  </div>

  <div class="field">
    <%= f.label :avatar %><br />
    <%= f.file_field :avatar, onchange: "avatarImage(this);" %>
  </div>

  <div id="avatar" style="display:none;" >
    <span>選択したアバター画像</span><br />
    <img id="avatar_preview" class="rounded-circle" width="100" height="100">
  </div>

  <% if @user.avatar.attached? %>
    <span>登録済みアバター画像</span><br />
    <%= image_tag @user.avatar, class: "rounded-circle mb-3", width: '100', height: '100' %>
  <% end %>

  <div class="actions">
    <%= f.submit "Update" %>
  </div>
<% end %>

<%= link_to "Back", :back %>

<script>
  function avatarImage(obj){
    var fileReader = new FileReader();
    var avatarDiv = document.getElementById('avatar');

    if (obj.files && obj.files[0]) {
      fileReader.onload = (function() {
        document.getElementById('avatar_preview').src = fileReader.result; // プレビューに画像を設定
        avatarDiv.style.display = 'block'; // プレビューを表示
      });
      fileReader.readAsDataURL(obj.files[0]); // 画像ファイルを読み込む
    } else {
      avatarDiv.style.display = 'none'; // 画像が選択されていない場合は非表示
    }
  }
</script>